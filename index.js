(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var e=function(){function e(t,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.controller=t,this.editor=n,this.backup="",this.backCursor={line:0,pos:0,number:0},this.textRow=[""],this.execute=function(){return o()}}var n,o;return n=e,(o=[{key:"saveBackup",value:function(){this.backup=this.editor.text,this.backCursor=this.editor.cursor,this.textRow=this.editor.textRow}},{key:"undo",value:function(){this.editor=this.backup}}])&&t(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),e}();function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){return o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},o(t,e)}function r(t,e){if(e&&("object"===n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function i(t){return i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},i(t)}var s=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&o(t,e)}(a,t);var e,n,s,c=(n=a,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=i(n);if(s){var o=i(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return r(this,t)});function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=c.call(this,t,e,(function(){return n.controller=t,n.controller.select=e.getSelect(),!1}))).ex=n.execute(),n}return e=a,Object.defineProperty(e,"prototype",{writable:!1}),e}(e);function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function a(t,e){return a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},a(t,e)}function u(t,e){if(e&&("object"===c(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}var f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}(i,t);var e,n,o,r=(n=i,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=l(n);if(o){var r=l(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return u(this,t)});function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),n=r.call(this,t,e,(function(){return n.saveBackup(),n.controller=t,n.controller.select=e.getSelect(),e.deleteSelect(),!0}))}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(e);function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function p(t,e){return p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},p(t,e)}function y(t,e){if(e&&("object"===h(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function b(t){return b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},b(t)}var v=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&p(t,e)}(i,t);var e,n,o,r=(n=i,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=b(n);if(o){var r=b(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return y(this,t)});function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),n=r.call(this,t,e,(function(){return n.saveBackup(),e.replaceSelect(t.select),e.deleteSelect(),!0}))}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(e);function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function m(t,e){return m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},m(t,e)}function w(t,e){if(e&&("object"===d(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function g(t){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},g(t)}var C=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&m(t,e)}(i,t);var e,n,o,r=(n=i,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=g(n);if(o){var r=g(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return w(this,t)});function i(t,e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),r.call(this,t,e,(function(){return t.undo(),!1}))}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(e);function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function x(t,e){return x=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},x(t,e)}function k(t,e){if(e&&("object"===O(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function j(t){return j=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},j(t)}var R=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&x(t,e)}(i,t);var e,n,o,r=(n=i,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=j(n);if(o){var r=j(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return k(this,t)});function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),n=r.call(this,t,e,(function(){return n.saveBackup(),e.addSymbol(t.addSymbol),!0}))}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(e);function _(t){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_(t)}function S(t,e){return S=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},S(t,e)}function P(t,e){if(e&&("object"===_(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function B(t){return B=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},B(t)}var T=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&S(t,e)}(i,t);var e,n,o,r=(n=i,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=B(n);if(o){var r=B(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return P(this,t)});function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),n=r.call(this,t,e,(function(){return n.saveBackup(),e.deleteSymbol(t.deleteDirection),!0}))}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(e);function E(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var K=function(){function t(e){var n,o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.line,r=t.pos;return o.cursorPoint=r<77&&!e?{line:n,pos:r+1}:{line:n+1,pos:0},o.cursorPoint},"add"in this?Object.defineProperty(this,"add",{value:n,enumerable:!0,configurable:!0,writable:!0}):this.add=n,this.state=e}var e,n;return e=t,(n=[{key:"remove",value:function(t,e){this.text=e;var n=t.line,o=t.pos;return o>0?{line:n,pos:o-1}:{line:n-1,pos:77}}}])&&E(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function L(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function A(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var D=function(){function t(e,n,o){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),A(this,"controlCombinations",[["Control","Delete"],["Control","Backspace"],["Control","KeyX"],["Control","KeyC"],["Control","KeyV"],["Control","KeyZ"],["Control","KeyS"],["Control","KeyA"],["Control","KeyB"],["Control","KeyI"],["Control","KeyU"],["Control","BracketLeft"],["Control","BracketRight"],["Control","KeyL"],["Control","KeyE"],["Control","KeyR"],["Control","KeyY"],["Control","Shift"]]),A(this,"up",(function(){var t=r.state.getCursor(),e=t.line,n=t.pos,o=t.number,i=r.state.getTextRow();if(0!==e)if(i[e-1].length>n){var s=o-n-(i[e-1].length-n);r.state.setCursor({line:e-1,pos:n,number:s})}else if(i[e-1].length===n){var c=o-n-1;r.state.setCursor({line:e-1,pos:i[e-1].length-1,number:c})}else{var a=o-n-1;r.state.setCursor({line:e-1,pos:i[e-1].length-1,number:a})}})),A(this,"down",(function(){var t=r.state.getCursor(),e=t.line,n=t.pos,o=t.number,i=r.state.getTextRow();if(e!==i.length-1)if(i[e+1].length>n){var s=o+(i[e].length-n)+n;r.state.setCursor({line:e+1,pos:n,number:s})}else{var c=o+(i[e].length-n)+i[e+1].length-1;r.state.setCursor({line:e+1,pos:i[e+1].length-1,number:c})}})),A(this,"left",(function(){var t=r.state.getCursor(),e=t.line,n=t.pos,o=t.number,i=r.state.getTextRow();0!==n?r.state.setCursor({line:e,pos:n-1,number:o-1}):0!==e&&r.state.setCursor({line:e-1,pos:i[e-1].length-1,number:o-1})})),A(this,"right",(function(){var t=r.state.getCursor(),e=t.line,n=t.pos,o=t.number,i=r.state.get(),s=r.state.getTextRow();o<i.length&&(n<s[e].length-1?r.state.setCursor({line:e,pos:n+1,number:o+1}):r.state.setCursor({line:e+1,pos:0,number:o+1}))})),A(this,"add",(function(t){r.addSymbol=t,r.editor.text=r.state.get(),r.editor.textRow=r.state.getTextRow(),r.editor.cursor=r.state.getCursor(),r.executeCommand(new R(r,r.editor)),r.state.set(r.editor.text),r.state.setCursor(r.editor.cursor),r.state.setTextRow(r.editor.textRow),r.addSymbol=""})),A(this,"delete",(function(t){r.deleteDirection="Backspace"===t?"prev":"next",r.editor.text=r.state.get(),r.editor.textRow=r.state.getTextRow(),r.editor.cursor=r.state.getCursor(),r.executeCommand(new T(r,r.editor)),r.state.set(r.editor.text),r.state.setCursor(r.editor.cursor),r.state.setTextRow(r.editor.textRow)})),A(this,"copy",(function(){r.executeCommand(new s(r,r.editor))})),A(this,"cut",(function(){r.executeCommand(new f(r,r.editor))})),A(this,"paste",(function(){r.executeCommand(new v(r,r.editor))})),A(this,"undo",(function(){r.executeCommand(new C(r,r.editor))})),this.state=e,this.select="",this.editor=n,this.history=o,this.cursor=new K(this.state),this.lastKey=null,this.addSymbol="",this.activeControls={},this.lastControl={id:null,time:null},this.hasActivShift=function(){var t=Object.keys(r.activeControls).filter((function(t){return 0!==r.activeControls[t]}));return 1===t.length&&(t.includes("ShiftLeft")||t.includes("ShiftRight"))},this.hasControls=function(){return 0!==Object.keys(r.activeControls).filter((function(t){return 0!==r.activeControls[t]})).length},this.resetControls=function(){r.activeControls={}}}var e,n;return e=t,(n=[{key:"initLang",value:function(){var t=["en","ru"],e=window.navigator.language.slice(0,2),n=localStorage.getItem("key_lang")||"",o=t.includes(e)?e:"en";t.includes(n)?this.state.setLang(n):this.state.setLang(o)}},{key:"mouseUp",value:function(t,e){var n=t.code;if(this.activeBtns=this.state.getActiveBtns(),this.lastKey===e)if(this.hasControls())0===this.activeControls[n]&&(this.activeBtns[e]=0),this.lastKey=null;else for(var o=Object.keys(this.activeBtns),r=0;r<o.length;r+=1)this.activeBtns[o[r]]=0;else if(null!==this.lastKey)if(this.hasControls())0===this.activeControls[this.lastKey]&&(this.activeBtns[this.lastKey]=0),this.lastKey=null;else for(var i=Object.keys(this.activeBtns),s=0;s<i.length;s+=1)this.activeBtns[i[s]]=0;this.state.changeActiveBtns(this.activeBtns)}},{key:"mouseDown",value:function(t,e,n,o){var r=t.type,i=t.code;this.activeBtns=this.state.getActiveBtns(),"control"===r?this.lastControl.id&&this.lastControl.id===i&&this.lastControl.time&&o-this.lastControl.time<300?(this.activeControls[i]=1,this.activeBtns[e]=1,this.lastKey=e):(this.hasControls()||(this.lastControl={id:i,time:o},this.activeBtns[e]=1,this.lastKey=e),this.hasControls()&&(this.activeControls[i]?(this.activeControls[i]=0,this.activeBtns[e]=1,this.lastKey=e,this.lastControl={id:null,time:null}):this.keyControl(i)?(this.resetControls(),this.lastControl={id:null,time:null},this.activeBtns[e]=1,this.lastKey=e):(this.activeBtns[e]=1,this.lastKey=e,this.lastControl={id:i,time:o}))):this.hasControls()?this.keyControl(i)?(this.resetControls(),this.lastControl={id:null,time:null},this.lastKey=e,this.activeBtns[e]=1):("capslock"===r?this.state.changeCapsLock():"move"===r?this.moveCursor(i):"delete"===r?this.delete(i):"meta"===r||this["".concat(r)](i,t["".concat(n)]),this.resetControls(),this.lastControl={id:null,time:null},this.lastKey=e,this.activeBtns[e]=1):(this.lastControl={id:null,time:null},this.lastKey=e,this.activeBtns[e]=1,"capslock"===r?this.state.changeCapsLock():"move"===r?this.moveCursor(i):"delete"===r?this.delete(i):"meta"===r||this["".concat(r)](i,t["".concat(n)])),this.state.changeActiveBtns(this.activeBtns)}},{key:"keyUp",value:function(t,e){var n=t.code;if(this.activeBtns=this.state.getActiveBtns(),this.hasControls())this.activeBtns[e]=0,1===this.activeControls[n]&&(this.activeControls[n]=0);else{1===this.activeControls[n]&&(this.activeControls[n]=0);for(var o=Object.keys(this.activeBtns),r=0;r<o.length;r+=1)this.activeBtns[o[r]]=0}this.state.changeActiveBtns(this.activeBtns)}},{key:"keyDown",value:function(t,e,n){var o=t.type,r=t.code;this.activeBtns=this.state.getActiveBtns(),"control"===o?(this.hasControls()||(this.activeControls[r]=1,this.activeBtns[e]=1),this.hasControls()&&(this.activeControls[r]||this.keyControl(r)?this.activeBtns[e]=1:(this.activeBtns[e]=1,this.activeControls[r]=1))):this.hasControls()?(this.keyControl(r)||("capslock"===o?this.state.changeCapsLock():"move"===o?this.moveCursor(r):"delete"===o?this.delete(r):"meta"===o||this["".concat(o)](r,t["".concat(n)])),this.activeBtns[e]=1):(this.activeBtns[e]=1,"capslock"===o?this.state.changeCapsLock():"move"===o?this.moveCursor(r):"delete"===o?this.delete(r):"meta"===o||this["".concat(o)](r,t["".concat(n)])),this.state.changeActiveBtns(this.activeBtns)}},{key:"symbol",value:function(t,e){var n,o=e.value,r=e.value_shift;n=t.includes("Key")?this.hasActivShift()&&!this.state.getCapsLock()||!this.hasActivShift()&&this.state.getCapsLock()?r:o:this.hasActivShift()?r:o,this.add(n)}},{key:"space",value:function(t,e){var n=e.value;this.add(n)}},{key:"moveCursor",value:function(t){return this[t.slice(5).toLowerCase()](),!0}},{key:"keyControl",value:function(t){var e=this,n=Object.keys(this.activeControls);n.push(t);for(var o=n.filter((function(n){return 0!==e.activeControls[n]||n===t})).map((function(t){return"ShiftLeft"===t||"ShiftRight"===t?"Shift":"AltLeft"===t||"AltRight"===t?"Alt":"ControlLeft"===t||"ControlRight"===t?"Control":t})),r=0;r<this.controlCombinations.length;r+=1)if(this.controlCombinations[r].every((function(t){return o.includes(t)}))){if("ControlShift"===this.controlCombinations[r].join("")){var i="en"===this.state.getLang()?"ru":"en";this.state.setLang(i),localStorage.setItem("key_lang",i)}if("ControlKeyZ"===this.controlCombinations[r].join("")){var s=this.history.history.pop();s&&(this.state.set(s.backup),this.state.setCursor(s.backCursor),this.state.setTextRow(s.textRow))}return this.controlCombinations[r]}return null}},{key:"executeCommand",value:function(t){t.execute()&&this.history.push(t)}}])&&L(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function N(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var I=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=[]}var e,n;return e=t,(n=[{key:"getKeysData",value:function(){var t=this;return fetch("./keys.json").then((function(t){return t.json()})).then((function(e){if(!Array.isArray(e))throw new Error("Data load error");return t.data=e,t.data}))}}])&&N(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function V(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var U=function(){function t(e){var n=e.parent,o=void 0===n?null:n,r=e.tagName,i=void 0===r?"div":r,s=e.className,c=void 0===s?"":s,a=e.content,u=void 0===a?"":a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var l=document.createElement(i);l.classList=c,l.innerHTML=u,o&&o.append(l),this.node=l}var e,n;return e=t,(n=[{key:"destroy",value:function(){this.node.remove()}}])&&V(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function H(t){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H(t)}function M(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function Z(t,e){return Z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Z(t,e)}function W(t,e){if(e&&("object"===H(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function X(t){return X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},X(t)}var Y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Z(t,e)}(s,t);var e,n,o,r,i=(o=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=X(o);if(r){var n=X(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return W(this,t)});function s(t){var e,n=t.parent,o=void 0===n?null:n,r=t.className,c=void 0===r?"":r,a=t.content,u=void 0===a?"":a,l=t.onClick,f=t.id;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(e=i.call(this,{parent:o,tagName:"button",className:c})).id=f,e.node.tabIndex="-1",e.update=function(t){e.setContent(t)},e.setContent(u),e.node.onmousedown=function(t){l("mouseDown",t.timeStamp),e.node.onmouseover=function(){return e.node.onmouseup()}},e.node.onmouseup=function(){l("mouseUp"),e.node.onmouseover=null},e}return e=s,(n=[{key:"setContent",value:function(t){2===t.length?this.node.innerHTML='<span class="btn__before">'.concat(t[0],'</span><span class="btn__content">').concat(t[1],"</span>"):this.node.innerHTML='<span class="btn__content">'.concat(t[0],"</span>")}}])&&M(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),s}(U);function q(t){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},q(t)}function z(t,e){return z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},z(t,e)}function F(t,e){if(e&&("object"===q(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function G(t){return G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},G(t)}var J=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&z(t,e)}(i,t);var e,n,o,r=(n=i,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=G(n);if(o){var r=G(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return F(this,t)});function i(t){var e,n=t.parent,o=void 0===n?null:n,s=t.className,c=void 0===s?"":s,a=t.onKey,u=t.onChangePoint;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=r.call(this,{parent:o,tagName:"textarea",className:c})).node.tabIndex="1",e.node.focus(),e.node.onkeydown=function(t){var e=t.code;t.preventDefault(),a("keyDown",e)},e.node.onkeyup=function(t){var e=t.code,n=t.timeStamp;t.preventDefault(),a("keyUp",e,n)},e.node.onpointerdown=function(t){u(t)},e.node.onpointerup=function(t){u(t)},e}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(U);function Q(t){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Q(t)}function $(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function tt(t,e){return tt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},tt(t,e)}function et(t,e){if(e&&("object"===Q(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function nt(t){return nt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},nt(t)}var ot=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tt(t,e)}(s,t);var e,n,o,r,i=(o=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=nt(o);if(r){var n=nt(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return et(this,t)});function s(t,e,n){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(o=i.call(this,{parent:t,tagName:"div",className:"keyboard"})).node.tabIndex="-1",o.node.onclick=function(){return o.textView.node.focus()},o.data=[],o.keys=[],o.controller=n,o.state=e,o.state.onChangeLang=function(t){o.changeLang(t)},o.lang="en",o.header=new U({parent:o.node,className:"keyboard__header header"}),o.langElement=new U({parent:o.header.node,className:"keyboard__lang lang"}),o.langElement.node.innerText=o.lang,o.descriptionElement=new U({parent:o.header.node,className:"keyboard__description description",content:"\n        <span>Virtual Keyboard реализована для Window OS</span>\n        <span>Для зажатия контрольной кнопки используйте двойной клик</span>\n      "}),o.textView=new J({parent:o.node,tagName:"textarea",className:"keyboard__textarea textarea",onKey:function(t,e,n){var r=o.findKey(e),i=r.findBtn,s=r.index;null!==i&&(o.controller["".concat(t)](i,s,o.lang,n),o.setActiveKey())},onChangePoint:function(t){n.changePoint(t)}}),o.textView.node.focus(),o.btns=new U({parent:o.node,className:"keyboard__btns btns"}),o.row=new U({className:"btns__row"}),o.row.tabIndex="-1";for(var r=0;r<5;r+=1)o["row".concat(r+1)]=o.row.node.cloneNode(!0),o.btns.node.append(o["row".concat(r+1)]);return(new I).getKeysData().then((function(t){o.data=t})).then((function(){o.data.forEach((function(t,e){var n=t.code,r=t.row,i=t["".concat(o.lang)].name,s=new Y({parent:o["row".concat(r)],className:"btns__btn btn ".concat(n),content:i,onClick:function(n,r){o.controller["".concat(n)](t,e,o.lang,r),o.textView.node.focus(),o.setActiveKey()},id:e});o.keys.push(s)})),o.state.onChange=function(t){o.update(t)},o.state.moveCursor=function(t){var e=t.start,n=t.end;o.updateCursor({start:e,end:n})},o.update(e.get()),o.controller.initLang()})),o.note=new U({parent:o.node,className:"keyboard__note note",content:"\n        Из контрольных комбинаций реализована Ctrl+Z (отмена) и Ctrl+Shift (смена языка)\n      "}),o}return e=s,(n=[{key:"findKey",value:function(t){var e=this.data.findIndex((function(e){return e.code===t}));return-1===e?null:{findBtn:this.data[e],index:e}}},{key:"setActiveKey",value:function(){var t=this;Object.keys(this.controller.activeBtns).forEach((function(e){1===t.controller.activeBtns[e]&&t.keys[e].node.classList.add("active"),0===t.controller.activeBtns[e]&&(t.keys[e].node.classList.remove("active"),delete t.controller.activeBtns[e])}))}},{key:"update",value:function(t){this.textView.node.value=t}},{key:"updateCursor",value:function(t){var e=t.start,n=t.end;this.textView.node.setSelectionRange(e,n)}},{key:"changeLang",value:function(t){this.lang=t;for(var e=0;e<this.keys.length;e+=1)this.keys[e].update(this.data[e]["".concat(t)].name);this.langElement.node.innerText=t}}])&&$(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),s}(U);function rt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var it=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.lang="en",this.state=e,this.textRow=[""],this.cursor={line:0,pos:0,number:0},this.capsLock=!1,this.activeBtns={},this.activeControls={}}var e,n;return e=t,(n=[{key:"get",value:function(){return this.state}},{key:"set",value:function(t){this.prev=this.state,this.state=t,this.onChange(this.state,this.prev)}},{key:"setLang",value:function(t){this.lang=t,this.onChangeLang(this.lang)}},{key:"getLang",value:function(){return this.lang}},{key:"getCursor",value:function(){return this.cursor}},{key:"setCursor",value:function(t){var e=t.line,n=t.pos,o=t.number;this.cursor={line:e,pos:n,number:o},this.moveCursor({start:o,end:o})}},{key:"getTextRow",value:function(){return this.textRow}},{key:"setTextRow",value:function(t){this.textRow=t}},{key:"getCapsLock",value:function(){return this.capsLock}},{key:"changeCapsLock",value:function(){this.capsLock=!this.capsLock}},{key:"getActiveBtns",value:function(){return this.activeBtns}},{key:"changeActiveBtns",value:function(t){this.activeBtns=t}}])&&rt(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function st(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var ct=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.text="",this.selectText="",this.textRow=[],this.cursor={line:0,pos:0,number:0}}var e,n;return e=t,(n=[{key:"addSymbol",value:function(t){var e=this.cursor,n=e.line,o=e.pos,r=e.number;r.length===this.text.length?("\n"===t?(this.textRow[n]+=t,this.textRow.push(""),this.cursor={line:n+1,pos:0,number:r+1}):77===this.textRow[n].length?(this.textRow.push(t),this.cursor={line:n+1,pos:1,number:r+1}):(this.textRow[n]+=t,this.cursor={line:n,pos:o+1,number:r+1}),this.text+=t):(this.text=this.text.slice(0,r)+t+this.text.slice(r),this.textRow=this.changeTextRow(this.text),this.cursor="\n"===t?{line:n+1,pos:0,number:r+1}:{line:n,pos:o+1,number:r+1})}},{key:"deleteSymbol",value:function(t){var e=this.cursor,n=e.line,o=e.pos,r=e.number;r===this.text.length?"prev"===t&&(0!==o?(this.text=this.text.slice(0,this.text.length-1),this.textRow[n]=this.textRow[n].slice(0,this.textRow[n].length-1),this.cursor={line:n,pos:o-1,number:r-1}):0!==n&&(this.text=this.text.slice(0,this.text.length-1),this.textRow[n-1]=this.textRow[n-1].slice(0,this.textRow[n-1].length-1),this.textRow.pop(),this.cursor={line:n-1,pos:this.textRow[n-1].length-1,number:r-1})):"prev"===t?0!==o?(this.text=this.text.slice(0,r-1)+this.text.slice(r),this.textRow=this.changeTextRow(this.text),this.cursor={line:n,pos:o-1,number:r-1}):(this.text=this.text.slice(0,r-1)+this.text.slice(r),this.cursor={line:n-1,pos:this.textRow[n].length-1,number:r-1},this.textRow=this.changeTextRow(this.text)):(this.text=this.text.slice(0,r)+this.text.slice(r+1),this.cursor={line:n,pos:o,number:r},this.textRow=this.changeTextRow(this.text))}},{key:"getSelect",value:function(){return this.selectText}},{key:"deleteSelect",value:function(){this.selectText=""}},{key:"replaceSelect",value:function(t){this.selectText=t}},{key:"changeTextRow",value:function(){var t=this.text.split("\n").map((function(t){return"".concat(t,"\n")}));return 1===t.length&&(t[0]=t[0].slice(0,t[0].length-1)),t.map((function(t){return t.length<=77?t:t.match(/.{1,77}/g)})).flat()}}])&&st(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function at(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var ut=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.history=[]}var e,n;return e=t,(n=[{key:"push",value:function(t){this.history.push(t)}},{key:"pop",value:function(){this.history.pop()}}])&&at(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),lt=new it(""),ft=new D(lt,new ct,new ut);new ot(document.body,lt,ft).controller.initLang()})();
//# sourceMappingURL=index.js.map